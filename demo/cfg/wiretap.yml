version: 1
formatters:
  console:
    style: "{"
    format: "{asctime}.{msecs:03d} | {module}.{funcName} | {message}"
    datefmt: "%Y-%m-%d %H:%M:%S"
    defaults:
      status: "<status>"
      correlation: "<correlation>"
      extra: "<extra>"
  wiretap:
    (): "logging.Formatter"
    # "()": wiretap.formatters.DotFormatter
    style: "{"
    datefmt: "%Y-%m-%d %H:%M:%S"
    fmt: "{asctime}.{msecs:03.0f} {indent} {activity_name} | {trace_name} | {activity_elapsed} | {trace_message} | {trace_snapshot} | {trace_tags}"
  elastic:
    "()": wiretap.formatters.JSONFormatter
    ".":
      json_encoder_cls: wiretap.json.JSONMultiEncoder
      fields:
        - $timestamp
        - $activity
        - $trace
        - $source
        - $exception
        - $previous
        - $sequence
        - $app_id
filters:
  timestamp_local:
    (): wiretap.filters.TimestampField
    tz: local
  timestamp_utc:
    (): wiretap.filters.TimestampField
    tz: utc
  indent:
    (): wiretap.filters.IndentField
    char: _
  strip_exc_info:
    (): wiretap.filters.StripExcInfo
  instance:
    (): wiretap.filters.ConstField
    mapping:
      $app_id: demo-1
  activity:
    (): wiretap.filters.ActivityField
  previous:
    (): wiretap.filters.PreviousField
  sequence:
    (): wiretap.filters.SequenceField
  trace:
    (): wiretap.filters.TraceField
  source:
    (): wiretap.filters.SourceField
  console:
    (): wiretap.filters.TemplateField
    mapping:
      activity_name: $activity.name
      activity_elapsed: $activity.elapsed
      trace_name: $trace.name
      trace_message: $trace.message
      trace_snapshot: $trace.snapshot
      trace_tags: $trace.tags
handlers:
  console:
    class: "logging.StreamHandler"
    formatter: "wiretap"
    level: "DEBUG"
    filters:
      - indent
      - activity
      - trace
      - console
  file:
    class: "logging.handlers.TimedRotatingFileHandler"
    when: "d"
    interval: 1
    filename: "c:\\temp\\wiretap.log"
    formatter: wiretap
    level: "DEBUG"
    filters:
      - indent
      - timestamp_local
      - strip_exc_info
  elastic_file:
    class: "logging.FileHandler"
    filename: "c:\\temp\\elastic.log"
    formatter: elastic
    level: "DEBUG"
    filters:
      - timestamp_utc
      - previous
      - sequence
      - source
      - instance
      - strip_exc_info
  #sqlserver:
  #  class: "wiretap_sqlserver.SqlServerHandler"
  #  #connection_string: "DRIVER={ODBC Driver 18 for SQL Server};SERVER=localhost,1433;DATABASE=automation;UID=sa;PWD=;"
  #  insert: null
  #  level: "DEBUG"
  #  formatter: "auto"

loggers:
  root:
    #handlers: [ "console", "file", "elastic_file" ]
    handlers: [ "console", "elastic_file" ]
    # handlers: [ "console" ]
    level: "DEBUG"
  PIL:
    level: "WARNING"